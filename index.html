<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Th·∫ª Open Graph cho h√¨nh ·∫£nh -->
    <meta property="og:image" content="gift_secret.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <title>T√¢m Birthday</title>
    <link rel="icon" type="image/x-icon" href="cake.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link rel="stylesheet" href="index.css" />
  </head>

  <body>
    <div
      class="container-fluid min-vh-100 d-flex align-items-center justify-content-center"
    >
      <div class="envelope light-green">
        <div class="envelope-clasp heart-shaped"></div>
        <div class="envelope-ribbon shiny"></div>
        <div class="envelope-flap top">
          <p class="flap-text hidden chuc">Ch√∫c</p>
        </div>
        <div class="envelope-flap bottom">
          <p class="flap-text hidden nhat">Nh·∫≠t</p>
        </div>
        <div class="envelope-flap left">
          <p class="flap-text hidden">Sinh</p>
        </div>
        <div class="envelope-flap right">
          <p class="flap-text hidden mung">M·ª´ng</p>
        </div>
        <div class="envelope-content">
          <div class="birthday-card">
            <div class="card-inner">
              <div class="row">
                <div class="col-12 text-center">
                  <h1 class="mb-4 animate__animated animate__bounceIn">
                    Happy Birthday, Tr·∫ßn Th·ªã T√¢m!
                  </h1>
                  <div class="cake-container mb-4">
                    <canvas id="cakeCanvas" width="300" height="300"></canvas>
                    <div class="candles">
                      <div class="candle"><div class="flame"></div></div>
                      <div class="candle"><div class="flame"></div></div>
                      <div class="candle"><div class="flame"></div></div>
                    </div>
                  </div>
                  <div class="balloon-container"></div>
                  <div class="fireworks-container"></div>
                  <!-- <p
                    class="lead animate__animated animate__fadeIn animate__delay-1s"
                  >
                    Join us for a magical celebration!
                  </p> -->
                  <p
                    class="animate__animated animate__fadeIn animate__delay-2s"
                  >
                    <strong>Date:</strong> 10 - 10 - 2024
                  </p>
                  <!-- <p
                    class="animate__animated animate__fadeIn animate__delay-2s"
                  >
                    <strong>Time:</strong> 2:00 PM
                  </p>
                  <p
                    class="animate__animated animate__fadeIn animate__delay-2s"
                  >
                    <strong>Venue:</strong> Enchanted Gardens
                  </p> -->
                </div>
              </div>
              <div class="row mt-4">
                <div class="col-md-6 x">
                  <div class="image-container position-relative ">
                    <img
                      src="birthday.png"
                      alt="Birthday Cake"
                      class="img-fluid rounded mb-3 animate__animated animate__zoomIn "
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="1">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-1">0</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 ">
                  <div class="image-container position-relative">
                    <img
                      src="mom.jpg"
                      alt="Party Decorations"
                      class="img-fluid mb-3 rounded animate__animated animate__zoomIn animate__delay-1s"
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="2">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-2">0</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 ">
                  <div class="image-container position-relative">
                    <img
                      src="mom2.jpg"
                      alt="Party Decorations"
                      class="img-fluid mb-3 rounded animate__animated animate__zoomIn animate__delay-1s"
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="3">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-3">0</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 ">
                  <div class="image-container position-relative">
                    <img
                      src="mom3.jpg"
                      alt="Party Decorations"
                      class="img-fluid mb-3 rounded animate__animated animate__zoomIn animate__delay-1s"
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="4">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-4">0</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="image-container  position-relative">
                    <img
                      src="mom4.jpg"
                      alt="Party Decorations"
                      class="img-fluid mb-3 rounded animate__animated animate__zoomIn animate__delay-1s"
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="5">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-5">0</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="image-container  position-relative">
                    <img
                      src="ducme.png"
                      alt="Party Decorations"
                      class="img-fluid mb-3 rounded animate__animated animate__zoomIn animate__delay-1s"
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="6">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-6">0</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 ">
                  <div class="image-container position-relative">
                    <img
                      src="ninhbinh.png"
                      alt="Party Decorations"
                      class="img-fluid mb-3 rounded animate__animated animate__zoomIn animate__delay-1s"
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="7">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-7">0</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 ">
                  <div class="image-container position-relative">
                    <img
                      src="anhoi.jpg"
                      alt="Party Decorations"
                      class="img-fluid mb-3 rounded animate__animated animate__zoomIn animate__delay-1s"
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="8">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-8">0</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 ">
                  <div class="image-container position-relative">
                    <img
                      src="https://images.unsplash.com/photo-1530103862676-de8c9debad1d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80"
                      alt="Party Decorations"
                      class="img-fluid rounded animate__animated animate__zoomIn animate__delay-1s"
                    />
                    <div class="heart-overlay">‚ù§Ô∏è</div>
                    <div class="like-container" data-id="9">
                      <i class="heart-icon">‚ù§Ô∏è</i>
                      <span class="like-count tym-9">0</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-center mt-4">
                <button
                  class="btn btn-lg btn-outline-primary gift-box animate__animated animate__pulse animate__infinite"
                  aria-label="Open gift box"
                >
                  üéÅ T·∫∑ng qu√†
                </button>
              </div>
              <div class="wishes-container mt-4" id="wishesContainer"></div>
              <div class="text-center mt-4">
                <button
                  class="btn btn-lg btn-outline-primary gift-box2 animate__animated animate__pulse animate__infinite"
                  aria-label="Open gift box"
                >
                  üéÅ T·∫∑ng qu√†
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="wishesModal"
      tabindex="-1"
      aria-labelledby="wishesModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="wishesModalLabel">
              G·ª≠i nh·ªØng l·ªùi ch√∫c t·ªët ƒë·∫πp nh·∫•t ƒë·∫øn Tr·∫ßn Th·ªã T√¢m.
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="wishesForm">
              <div class="mb-3">
                <label for="wishMessage" class="form-label"
                  >L·ªùi ch√∫c c·ªßa b·∫°n:</label
                >
                <textarea
                  class="form-control"
                  id="wishMessage"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="senderName" class="form-label">T√™n c·ªßa b·∫°n:</label>
                <input
                  type="text"
                  class="form-control"
                  id="senderName"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary btn-send-wish">
                G·ª≠i l·ªùi ch√∫c üéÅ
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <audio id="backgroundMusic" loop>
      <source src="music.mp3" type="audio/mpeg" />
    </audio>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const envelope = document.querySelector(".envelope");
        const clasp = document.querySelector(".envelope-clasp");
        const ribbon = document.querySelector(".envelope-ribbon");
        const flaps = document.querySelectorAll(".envelope-flap");
        const flapsH1 = document.querySelectorAll(".flap-text");
        const card = document.querySelector(".birthday-card");
        const giftBox = document.querySelector(".gift-box");
        const giftBox2 = document.querySelector(".gift-box2");
        const wishesModal = new bootstrap.Modal(
          document.getElementById("wishesModal")
        );
        const wishesForm = document.getElementById("wishesForm");
        const wishesContainer = document.querySelector(".wishes-container");
        const backgroundMusic = document.getElementById("backgroundMusic");

        let interval; // Khai b√°o bi·∫øn interval ·ªü ƒë√¢y ƒë·ªÉ c√≥ th·ªÉ d·ª´ng trong h√†m kh√°c
        let isScrolling = false;
        let isCallingData = false;

        envelope.addEventListener("click", function () {
          clasp.style.animation = "unlockClasp 2s forwards";
          ribbon.style.animation = "untieRibbon 2s forwards";
          backgroundMusic.play();
          flapsH1.forEach((flap) => {
            flap.classList.add("showText");
          });

          flaps.forEach((flap) => {
            flap.style.animation = "openFlap 5.5s forwards";
          });

          const envelopeContent = document.querySelector(".card-inner");

          // H√†m cu·ªôn t·ª± ƒë·ªông b√™n trong ph·∫ßn t·ª≠ envelope-content
          function autoScrollEnvelope() {
            if (isScrolling) return;

            isScrolling = true; // ngƒÉn kh√¥ng cho t·ª± ƒë·ªông scrolling l·∫°i khi click v√†o m√†n h√¨nh v√¨ ƒëang n·∫±m trong s·ª± ki·ªán click c·ªßa envelop
            const scrollSpeed = 1; // ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô cu·ªôn
            const maxScroll =
              envelopeContent.scrollHeight - envelopeContent.clientHeight;

            interval = setInterval(() => {
              if (envelopeContent.scrollTop < maxScroll) {
                envelopeContent.scrollBy(0, scrollSpeed); // Cu·ªôn t·ª´ t·ª´ theo t·ª´ng pixel
              } else {
                clearInterval(interval); // D·ª´ng cu·ªôn khi ƒë·∫øn cu·ªëi ph·∫ßn t·ª≠
              }
            }, 40); // T·∫ßn s·ªë cu·ªôn (16ms ~ 60fps)
          }

          // D·ª´ng cu·ªôn khi c√≥ h√†nh ƒë·ªông click ho·∫∑c ch·∫°m v√†o m√†n h√¨nh
          function stopScroll() {
            clearInterval(interval);
            window.removeEventListener("click", stopScroll); // Lo·∫°i b·ªè s·ª± ki·ªán sau khi d·ª´ng
            window.removeEventListener("touchstart", stopScroll); // ƒê·ªëi v·ªõi thi·∫øt b·ªã c·∫£m ·ª©ng
          }

          // L·∫Øng nghe s·ª± ki·ªán click v√† ch·∫°m ƒë·ªÉ d·ª´ng cu·ªôn
          window.addEventListener("click", stopScroll);
          window.addEventListener("touchstart", stopScroll);

          setTimeout(() => {
            clasp.classList.add("hidden");
            ribbon.classList.add("hidden");
            flaps.forEach((flap) => {
              flap.classList.add("hidden");
            });
            card.style.animation = "growCard 5.5s forwards";

            createBalloons();
            createFireworks();
          }, 5500);

          setTimeout(() => {
            clasp.classList.add("hidden");
            // G·ªçi h√†m cu·ªôn t·ª± ƒë·ªông khi ph·∫ßn t·ª≠ ƒë∆∞·ª£c t·∫£i
            autoScrollEnvelope();
          }, 10000);

          if (!isCallingData) {
            // call api get wish
            getDataFromSheet().then((data) => {
              // X·ª≠ l√Ω d·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c t·ª´ API
              // console.log("Data:", data);
              data.forEach((element) => {
                if(element.IsActive){
                  addWish(element.Message, element.Sender);
                }
              });
            });

            // call api get quantity react
            getQuantityReact();

            isCallingData = true;
          }
        });

        giftBox.addEventListener("click", function (event) {
          event.stopPropagation();
          wishesModal.show();
          const message = document.getElementById("wishMessage");
          message.focus();
        });

        giftBox2.addEventListener("click", function (event) {
          event.stopPropagation();
          wishesModal.show();
          const message = document.getElementById("wishMessage");
          message.focus();
        });

        wishesForm.addEventListener("submit", function (event) {
          event.preventDefault();
          createBalloons();
          createFireworks();
          const message = document.getElementById("wishMessage").value;
          const sender = document.getElementById("senderName").value;
          addWish(message, sender);
          addDataToSheet(message, sender);
          wishesModal.hide();
          this.reset();
        });

        // Th√™m c√°c wishes m·∫´u sau khi DOM ƒë√£ load
        addWish("ch√∫c", "duclba");
        addWish("m·ª´ng", "duclba");
        addWish("sinh", "duclba");
        addWish("nh·∫≠t", "duclba");

        function addWish(message, sender) {
          const wish = document.createElement("div");
          wish.classList.add("wish", "animate__animated", "animate__fadeIn");
          const randomColorWish = `hsl(${Math.random() * 360}, 100%, 75%)`;
          wish.style.backgroundColor = randomColorWish;

          const randomColor = `hsl(${Math.random() * 360}, 100%, 75%)`;
          wish.innerHTML = `
                    <div class="wish-pin" style="background-color: ${randomColor};"></div>
                    <p>${message}</p>
                    <p class="sender">- ${sender}</p>
                `;
          wishesContainer.appendChild(wish);
        }

        function createBalloons() {
          const balloonContainer = document.querySelector(".balloon-container");
          const colors = ["#ff6b6b", "#4ecdc4", "#45b7d1", "#fdcb6e"];
          for (let i = 0; i < 20; i++) {
            const balloon = document.createElement("div");
            balloon.classList.add("balloon");
            balloon.style.left = `${Math.random() * 100}%`;
            balloon.style.animationDuration = `${Math.random() * 3 + 2}s`;
            balloon.style.backgroundColor =
              colors[Math.floor(Math.random() * colors.length)];
            balloonContainer.appendChild(balloon);
          }
          setTimeout(() => {
            balloonContainer.innerHTML = "";
          }, 20000);
        }

        function createFireworks() {
          const fireworksContainer = document.querySelector(
            ".fireworks-container"
          );
          const colors = ["#ff6b6b", "#4ecdc4", "#45b7d1", "#fdcb6e"];
          for (let i = 0; i < 60; i++) {
            setTimeout(() => {
              const firework = document.createElement("div");
              firework.classList.add("firework");
              firework.style.left = `${Math.random() * 100}%`;
              firework.style.top = `${Math.random() * 100}%`;
              firework.style.backgroundColor =
                colors[Math.floor(Math.random() * colors.length)];
              fireworksContainer.appendChild(firework);
              setTimeout(() => firework.remove(), 7000);
            }, i * 300);
          }
        }
      });

      // Canvas for cake
      const cakeCanvas = document.getElementById("cakeCanvas");
      const ctx = cakeCanvas.getContext("2d");

      function drawCake() {
        // Base
        ctx.fillStyle = "#FFD700";
        ctx.beginPath();
        ctx.ellipse(150, 250, 120, 40, 0, 0, 2 * Math.PI);
        ctx.fill();

        // Layers
        const layers = [
          { y: 200, color: "#FF69B4", pattern: "dots" },
          { y: 150, color: "#87CEFA", pattern: "stripes" },
          { y: 100, color: "#98FB98", pattern: "swirls" },
        ];

        layers.forEach((layer) => {
          ctx.fillStyle = layer.color;
          ctx.beginPath();
          ctx.ellipse(150, layer.y, 100, 30, 0, 0, 2 * Math.PI);
          ctx.fill();

          // Add patterns
          ctx.save();
          ctx.clip();
          switch (layer.pattern) {
            case "dots":
              for (let i = 0; i < 50; i++) {
                ctx.fillStyle = "rgba(255,255,255,0.5)";
                ctx.beginPath();
                ctx.arc(
                  Math.random() * 300,
                  layer.y + Math.random() * 60 - 30,
                  2,
                  0,
                  2 * Math.PI
                );
                ctx.fill();
              }
              break;
            case "stripes":
              ctx.strokeStyle = "rgba(255,255,255,0.5)";
              ctx.lineWidth = 2;
              for (let i = 0; i < 10; i++) {
                ctx.beginPath();
                ctx.moveTo(0, layer.y + i * 6 - 30);
                ctx.lineTo(300, layer.y + i * 6 - 30);
                ctx.stroke();
              }
              break;
            case "swirls":
              ctx.strokeStyle = "rgba(255,255,255,0.5)";
              ctx.lineWidth = 2;
              for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.arc(150 + i * 20, layer.y, 10 + i * 5, 0, 2 * Math.PI);
                ctx.stroke();
              }
              break;
          }
          ctx.restore();
        });

        // Fruit toppings
        const fruits = [
          { x: 100, y: 80, color: "#FF0000", size: 10 }, // Cherry
          { x: 200, y: 90, color: "#FFA500", size: 15 }, // Orange slice
          { x: 150, y: 70, color: "#8B4513", size: 12 }, // Chocolate piece
        ];

        fruits.forEach((fruit) => {
          ctx.fillStyle = fruit.color;
          ctx.beginPath();
          ctx.arc(fruit.x, fruit.y, fruit.size, 0, 2 * Math.PI);
          ctx.fill();
        });

        // Sprinkles
        for (let i = 0; i < 100; i++) {
          ctx.fillStyle = [
            "#FF0000",
            "#00FF00",
            "#0000FF",
            "#FFFF00",
            "#FF00FF",
          ][Math.floor(Math.random() * 5)];
          ctx.beginPath();
          ctx.rect(Math.random() * 300, Math.random() * 200 + 50, 2, 6);
          ctx.fill();
        }
      }

      drawCake();
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const likeContainers = document.querySelectorAll(".like-container");

        likeContainers.forEach((likeContainer) => {
          const likeCount = likeContainer.querySelector(".like-count");
          let count = parseInt(likeCount.textContent, 10);
          const heartOverlay =
            likeContainer.parentElement.querySelector(".heart-overlay");

          // H√†m ƒë·ªÉ hi·ªán v√† ·∫©n tr√°i tim
          function showHeart() {
            heartOverlay.classList.add("heart-show");
            setTimeout(() => {
              heartOverlay.classList.remove("heart-show");
            }, 1000); // Hi·ªán trong 1 gi√¢y
          }

          // X·ª≠ l√Ω s·ª± ki·ªán nh·∫•n chu·ªôt
          likeContainer.addEventListener("click", () => {
            count = parseInt(likeCount.textContent, 10);
            console.log("count", count);

            count += 1;

            likeCount.textContent = count;
            showHeart(); // Hi·ªán tr√°i tim ho·∫°t h√¨nh

            // L·∫•y id t·ª´ thu·ªôc t√≠nh data c·ªßa likeContainer
            const id = likeContainer.dataset.id;
            let quantity = count; // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng theo count m·ªõi

            // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng like tr√™n giao di·ªán
            likeCount.textContent = quantity;

            // G·ª≠i s·ªë l∆∞·ª£ng c·∫≠p nh·∫≠t ƒë·∫øn API
            updateQuantityReact(id, quantity);
          });
        });
      });
    </script>

    <script src="index.js" type="text/javascript"></script>
  </body>
</html>
